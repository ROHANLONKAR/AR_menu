<!doctype html>
}


function updateCard(){
state.list = filtered();
if(state.list.length === 0){
uiTitle.textContent = 'No items in this category';
uiMeta.textContent = '';
itemTitle.setAttribute('value', '—');
itemMeta.setAttribute('value', '');
imgPlane.setAttribute('material', 'src:#placeholder; transparent:true; shader:standard');
orderBtn.onclick = null; return;
}
clampIdx();
const it = state.list[state.idx];


// Update UI texts
const price = `$${it.price.toFixed(2)}`;
const tags = (it.tags||[]).join(', ');
uiTitle.textContent = it.name;
uiMeta.textContent = `${price}${tags? ' • ' + tags : ''}`;
itemTitle.setAttribute('value', it.name);
itemMeta.setAttribute('value', `${price}${tags? ' • ' + tags : ''}`);


// Find or create an <img> asset for this URL
let assetImg = [...assets.children].find(img => img.tagName === 'IMG' && img.src === it.image);
if(!assetImg){ assetImg = document.createElement('img'); assetImg.crossOrigin = 'anonymous'; assetImg.src = it.image; assets.appendChild(assetImg); }


// Set the plane texture to the asset
imgPlane.setAttribute('material', `src:${assetImg.id ? '#' + assetImg.id : it.image}; transparent:true; shader:standard`);


// Order button
orderBtn.onclick = () => window.open(it.orderUrl || '#', '_blank');
}


// Event wiring
filterSel.onchange = () => { state.filter = filterSel.value; state.idx = 0; updateCard(); };
prevBtn.onclick = () => { state.idx--; updateCard(); };
nextBtn.onclick = () => { state.idx++; updateCard(); };


// Init
preloadImages(MENU);
updateCard();


// Basic AR availability check → show fallback if needed
async function checkCamera(){
try{
await navigator.mediaDevices.getUserMedia({video:true});
}catch(e){
document.getElementById('fallback').style.display = 'flex';
}
}
checkCamera();


// Simple non-AR list view when AR not available
document.getElementById('openList').onclick = (e)=>{
e.preventDefault();
const div = document.createElement('div');
div.style.cssText = 'position:fixed;inset:0;background:#fff;color:#111;overflow:auto;padding:20px';
div.innerHTML = '<h2>Menu</h2>' + MENU.map(i=>`<div style="border:1px solid #eee;border-radius:12px;padding:12px;margin:10px 0;display:flex;gap:12px;align-items:center"><img src="${i.image}" style="width:120px;height:80px;object-fit:cover;border-radius:10px"/><div style="flex:1"><div style="font-weight:700">${i.name}</div><div style="opacity:.7">$${i.price.toFixed(2)} ${i.tags? '• '+i.tags.join(', '): ''}</div></div><a href="${i.orderUrl}" target="_blank" style="text-decoration:none;background:#111;color:#fff;padding:8px 12px;border-radius:999px">Order</a></div>`).join('');
document.body.appendChild(div);
};
</script>
</body>
</html>
